<%- include('./partials/_top_admin') %>

<link
  rel="stylesheet"
  type="text/css"
  href="https://cdn.datatables.net/1.11.1/css/jquery.dataTables.css"
/>

<div class="container">
  <% if (message) { %>
  <h4><%= message %></h4>
  <% } %>

  <h1 class="mt-5"><%- title %></h1>
  <p class="color-adduOrange">
    Change or update the user details, username, and password.
  </p>

  <table id="myTable" class="table table-hover table-bordered">
    <thead class="bg-addu">
      <tr>
        <th class="d-none">Id</th>
        <th scope="col">Full Name</th>
        <th scope="col">Username</th>
        <th scope="col">Status</th>
      </tr>
    </thead>
    <tbody>
      <% admins.forEach(admin => { %>
      <tr>
        <td class="d-none"><%= admin.id %></td>
        <td><%= admin.firstName %> <%= admin.lastName %></td>
        <td><%= admin.username %></td>
        <td><%= admin.status %></td>
      </tr>
      <% }) %>
    </tbody>
  </table>

  <% if (selectedAdmin) { %>
  <ul class="nav nav-tabs mt-4 pt-3" id="myTab" role="tablist">
    <li class="nav-item p">
      <a
        class="nav-link active"
        id="userDetails-tab"
        data-toggle="tab"
        href="#userDetails"
        role="tab"
        aria-controls="userDetails"
        aria-selected="true"
        >User Details</a
      >
    </li>
    <li class="nav-item">
      <a
        class="nav-link"
        id="username-tab"
        data-toggle="tab"
        href="#username"
        role="tab"
        aria-controls="username"
        aria-selected="false"
        >Username</a
      >
    </li>
    <li class="nav-item">
      <a
        class="nav-link"
        id="password-tab"
        data-toggle="tab"
        href="#password"
        role="tab"
        aria-controls="password"
        aria-selected="false"
        >Password</a
      >
    </li>
  </ul>

  <!-- User Details Tab -->
  <div
    class="tab-content border-left border-right border-bottom"
    id="myTabContent"
  >
    <div
      class="tab-pane fade show active p-4"
      id="userDetails"
      role="tabpanel"
      aria-labelledby="userDetails-tab"
    >
      <form action="/updateAdminDetails" method="POST">
        <input type="text" hidden name="id" value="<%= selectedAdmin.id %>" />

        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="firstName"> First Name </label>
              <input
                type="text"
                class="form-control"
                id="firstName"
                name="firstName"
                value="<%= selectedAdmin.firstName %>"
                required
              />
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="lastName"> Last Name </label>
              <input
                type="text"
                class="form-control"
                id="lastName"
                name="lastName"
                value="<%= selectedAdmin.lastName %>"
                required
              />
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="contactNumber"> Contact Number </label>
              <input
                type="text"
                class="form-control"
                id="contactNumber"
                name="contactNumber"
                value="<%= selectedAdmin.contactNumber %>"
                required
              />
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="email"> Email address </label>
              <input
                type="text"
                class="form-control"
                id="email"
                name="email"
                value="<%= selectedAdmin.email %>"
                required
              />
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-12">
            <div class="form-group">
              <label for="address"> Address </label>
              <input
                type="text"
                class="form-control"
                id="address"
                name="address"
                value="<%= selectedAdmin.address %>"
                required
              />
            </div>
          </div>
        </div>

        <input type="submit" class="btn bg-adduOrange" value="   Save   " />
      </form>
    </div>

    <!-- Username Tab -->
    <div
      class="tab-pane fade p-4"
      id="username"
      role="tabpanel"
      aria-labelledby="username-tab"
    >
      <div id="usernameAlert" class="alert alert-danger d-none" role="alert">
        This is a danger alert—check it out!
      </div>

      <form id="usernameForm" action="/updateAdminUsername" method="POST">
        <input type="text" hidden name="id" value="<%= selectedAdmin.id %>" />

        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="oldUsername"> Old Username </label>
              <input
                type="text"
                class="form-control"
                id="oldUsername"
                name="oldUsername"
                value="<%= selectedAdmin.username %>"
                disabled
              />
            </div>
          </div>
          <div class="col-md-6"></div>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="newUsername"> New Username </label>
              <input
                type="text"
                class="form-control"
                id="newUsername"
                name="newUsername"
              />
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="confirmUsername"> Confirm Username </label>
              <input
                type="text"
                class="form-control"
                id="confirmUsername"
                name="confirmUsername"
              />
            </div>
          </div>
        </div>

        <input type="submit" class="btn bg-adduOrange" value="   Save   " />
      </form>
    </div>

    <!-- Password Tab -->
    <div
      class="tab-pane fade p-4"
      id="password"
      role="tabpanel"
      aria-labelledby="password-tab"
    >
      <div id="passwordAlert" class="alert alert-danger d-none" role="alert">
        This is a danger alert—check it out!
      </div>

      <form id="passwordForm" action="/updateAdminPassword" method="POST">
        <input type="text" hidden name="id" value="<%= selectedAdmin.id %>" />

        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="newPassword"> New Password </label>
              <input
                type="password"
                class="form-control"
                id="newPassword"
                name="newPassword"
              />
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="confirmPassword"> Confirm Password </label>
              <input
                type="password"
                class="form-control"
                id="confirmPassword"
                name="confirmPassword"
              />
            </div>
          </div>
        </div>

        <input type="submit" class="btn bg-adduOrange" value="   Save   " />
      </form>
    </div>

    <% } %>
  </div>
</div>

<script
  defer
  type="text/javascript"
  charset="utf8"
  src="https://cdn.datatables.net/1.11.1/js/jquery.dataTables.js"
></script>

<script>
  window.addEventListener("DOMContentLoaded", function () {
    (function ($) {
      const table = $("#myTable").DataTable();

      $("#myTable tbody").on("click", "tr", function () {
        const data = table.row(this).data();
        window.location = `/usersettings?id=${data[0]}`;
      });

      $("#usernameForm").on("submit", async function (event) {
        event.preventDefault();

        const newUsername = $("#newUsername").val();
        const confirmUserName = $("#confirmUsername").val();

        if (!newUsername) {
          $("#usernameAlert")
            .removeClass("d-none")
            .text("Username cannot be empty.");
        } else if (newUsername !== confirmUserName) {
          $("#usernameAlert")
            .removeClass("d-none")
            .text("Usernames did not match.");
        } else {
          $(this).unbind();
          $(this).submit();
        }
      });

      $("#passwordForm").on("submit", async function (event) {
        event.preventDefault();

        const newPassword = $("#newPassword").val();
        const confirmPassword = $("#confirmPassword").val();

        if (!newPassword) {
          $("#passwordAlert")
            .removeClass("d-none")
            .text("Password cannot be empty.");
        } else if (newPassword !== confirmPassword) {
          $("#passwordAlert")
            .removeClass("d-none")
            .text("Passwords did not match.");
        } else {
          $(this).unbind();
          $(this).submit();
        }

        $("#newPassword").val("");
        $("#confirmPassword").val("");
      });
    })(jQuery);
  });
</script>

<%- include('./partials/_bottom') %>
