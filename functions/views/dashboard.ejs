<%- include('./partials/_top_admin') %>

  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.1/css/jquery.dataTables.css" />
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css"
    integrity="sha512-mSYUmp1HYZDFaVKK//63EcZq4iFWFjxSL+Z3T/aCt4IO9Cejm03q3NKKYN6pFQzY0SBOr8h+eCIAZHPXcpZaNw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />


  <div class="container">
    <% if (message) { %>
      <h5 class="mt-2 color-adduOrange">
        <%= message %>
      </h5>
      <% } %>

        <h1 class="mt-4">
          <%- title %>
        </h1>
        <p class="color-adduOrange">
          <b>Change or update the user details.</b>
          <br>
          * Use <i>filter data</i> button to seek specific users through their status, date of contact, or if they have a positive history.
        </p>

        <div>
          <div class="row">
            <div class="col-md-3">
              <label for="statusFilter">Status</label>
              <select class="form-control" name="status" id="statusFilter">
                <option></option>
                <option value="Positive">Positive</option>
                <option value="Negative">Negative</option>
              </select>
            </div>
            <div class="col-md-3">
              <label for="fromDateFilter">Date of Contact</label>
              <div class="input-group input-daterange">
                <input type="text" class="form-control" id="fromDateFilter" value="">
                <div class="input-group-prepend input-group-append">
                  <span class="input-group-text">to</span>
                </div>
                <input type="text" class="form-control" id="toDateFilter" value="">
              </div>
            </div>
            <div class="col-md-3">
              <button class="btn btn-orange-addu" style=" margin-top: 2rem" id="filterButton">Filter Data</button>
            </div>
          </div>
        </div>

        <br />

        <table id="myTable" class="table table-hover table-bordered">
          <thead class="bg-addu">
            <tr>
              <th class="d-none">Id</th>
              <th scope="col">Full Name</th>
              <th scope="col">Date of Contact</th>
              <th scope="col">Status</th>
              <th scope="col">Vaccination Status</th>
            </tr>
          </thead>
          <tbody>
            <% users.forEach(user=> { %>
              <tr>
                <td class="d-none">
                  <%= user.id %>
                </td>
                <td>
                  <%= user.firstName %>
                    <%= user.lastName %>
                </td>
                <td>
                  <% if (user.timeOfContact) { %>
                  <%= new Date((new Date(user.timeOfContact._seconds * 1000)).getTime() - ((new Date(user.timeOfContact._seconds * 1000)).getTimezoneOffset() * 60000)).toISOString().substring(0, 10) %>
                  <% } %>
                </td>
                <td>
                  <%= user.status %>
                </td>
                <td>
                  <%= user.vacStatus %>
                </td>
              </tr>
              <% }) %>
          </tbody>
        </table>
      </div>
  

  <div class="container">
    <div class="color-adduOrange pt-2 pl-2 pr-2 pb-1" style="background-color: #e6e6e6;">
      <h4>More Information</h4>
  </div>
  <div class="container">
    <div class="row border-bottom border-left border-right p-2" style="background-color: #f8f8f8;">
      <div class="col-sm-4">
        <h3>Positive</h3>
        <p>If a person is identified as "positive", forms such as</p>
        <p>
          Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...
        </p>
      </div>
      <div class="col-sm-4">
        <h3>Negative</h3>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
        <p>
          Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...
        </p>
      </div>
      <div class="col-sm-4">
        <h3>FAQs</h3>
        <li>How long does it take for symptoms of the coronavirus disease to appear?
          <ul>
            On average it takes 5–6 days from when someone is infected with the virus for symptoms to show, however it can take up to 14 days.
          </ul>
        </li>
        <li>Can people with mild COVID-19 symptoms recover at home?
          <ul>
            Yes. People with mild symptoms who are otherwise healthy should manage their symptoms at home. On average it takes 5–6 days from when someone is infected with the virus for symptoms to show, however it can take up to 14 days.
          </ul>
        </li>
      </div>
    </div>
  </div>
  </div>

  <script defer type="text/javascript" charset="utf8"
    src="https://cdn.datatables.net/1.11.1/js/jquery.dataTables.js"></script>

  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"
    integrity="sha512-T/tUfKSV1bihCnd+MxKD0Hm1uBBroVYBOYSk1knyvQ9VyZJpc/ALb4P0r6ubwVPSGB2GvjeoMAJJImBG12TiaQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    window.addEventListener("DOMContentLoaded", function () {
      (function ($) {
        const table = $("#myTable").DataTable();

        $("#myTable tbody").on("click", "tr", function () {
          const data = table.row(this).data();
          window.location = `/userDetails?id=${data[0]}`;
        });

        $('#filterButton').on('click', function () {
          const statusFilter = $('#statusFilter').val();
          const fromDateFilter = $('#fromDateFilter').val();
          const toDateFilter = $('#toDateFilter').val();
          window.location = `/dashboard?statusFilter=${statusFilter}&fromDateFilter=${fromDateFilter}&toDateFilter=${toDateFilter}`;
        });

        const urlParams = new URLSearchParams(window.location.search);
        $('#statusFilter').val(urlParams.get('statusFilter'));
        $('#fromDateFilter').val(urlParams.get('fromDateFilter'));
        $('#toDateFilter').val(urlParams.get('toDateFilter'));

        $('.input-daterange').datepicker({
          orientation: "bottom auto",
          format: 'yyyy-mm-dd'
        });
      })(jQuery);
    });
  </script>

  <%- include('./partials/_bottom') %>