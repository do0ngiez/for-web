<%- include('./partials/_top') %>

  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.1/css/jquery.dataTables.css" />

  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css"
    integrity="sha512-mSYUmp1HYZDFaVKK//63EcZq4iFWFjxSL+Z3T/aCt4IO9Cejm03q3NKKYN6pFQzY0SBOr8h+eCIAZHPXcpZaNw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />


  <div class="container">
    <% if (message) { %>
      <h4>
        <%= message %>
      </h4>
      <% } %>

        <h1 class="mt-5">
          <%- title %>
        </h1>
        <p class="color-adduOrange">
          Change or update the user details.
        </p>

        <div>
          <div class="row">
            <div class="col-md-6">
              <label for="statusFilter">Status</label>
              <select class="form-control" name="status" id="statusFilter">
                <option></option>
                <option value="Positive">Positive</option>
                <option value="Negative">Negative</option>
              </select>
            </div>
            <div class="col-md-6">
              <label for="fromDateFilter">Time of Contact</label>
              <div class="input-group input-daterange">
                <input type="text" class="form-control" id="fromDateFilter" value="">
                <div class="input-group-prepend input-group-append">
                  <span class="input-group-text">to</span>
                </div>
                <input type="text" class="form-control" id="toDateFilter" value="">
              </div>
            </div>
          </div>

          <br />

          <button class="btn btn-primary" id="filterButton">Filter</button>
        </div>

        <br />

        <table id="myTable" class="table table-hover table-bordered">
          <thead class="bg-addu">
            <tr>
              <th class="d-none">Id</th>
              <th scope="col">Full Name</th>
              <th scope="col">Time of Contact</th>
              <th scope="col">Status</th>
            </tr>
          </thead>
          <tbody>
            <% users.forEach(user=> { %>
              <tr>
                <td class="d-none">
                  <%= user.id %>
                </td>
                <td>
                  <%= user.firstName %>
                    <%= user.lastName %>
                </td>
                <td>
                  <%= (new Date(user.timeOfContact._seconds * 1000)).toISOString().substring(0, 10) %>
                </td>
                <td>
                  <%= user.status %>
                </td>
              </tr>
              <% }) %>
          </tbody>
        </table>

        <% if (selectedUser) { %>
          <ul class="nav nav-tabs mt-4 pt-3" id="myTab" role="tablist">
            <li class="nav-item p">
              <a class="nav-link active" id="userDetails-tab" data-toggle="tab" href="#userDetails" role="tab"
                aria-controls="userDetails" aria-selected="true">User Details</a>
            </li>
            <!-- <li class="nav-item">
      <a
        class="nav-link"
        id="username-tab"
        data-toggle="tab"
        href="#username"
        role="tab"
        aria-controls="username"
        aria-selected="false"
        >Username</a
      >
    </li>
    <li class="nav-item">
      <a
        class="nav-link"
        id="password-tab"
        data-toggle="tab"
        href="#password"
        role="tab"
        aria-controls="password"
        aria-selected="false"
        >Password</a
      >
    </li> -->
          </ul>

          <!-- User Details Tab -->
          <div class="tab-content border-left border-right border-bottom" id="myTabContent">
            <div class="tab-pane fade show active p-4" id="userDetails" role="tabpanel"
              aria-labelledby="userDetails-tab">
              <!-- UPDATES DETAILS!!!!!!!!!!! -->
              <form action="/updateUserDetails" method="POST">
                <input type="text" hidden name="id" value="<%= selectedUser.id %>" />

                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="firstName"> First Name </label>
                      <input type="text" class="form-control" id="firstName" name="firstName"
                        value="<%= selectedUser.firstName %>" required />
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="lastName"> Last Name </label>
                      <input type="text" class="form-control" id="lastName" name="lastName"
                        value="<%= selectedUser.lastName %>" required />
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="Duration"> Duration (sec) </label>
                      <input type="number" class="form-control" id="duration" name="durationOfContact" <%# SHOULD MATCH
                        WITH DATABASE!!!!!!!!! %>
                      value="<%= selectedUser.durationOfContact %>"
                        required
                        />
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="Status"> Status </label>
                      <select class="form-control" name="status" id="status" required>
                        <option></option>
                        <option value="Positive">Positive</option>
                        <option value="Negative">Negative</option>
                      </select>
                    </div>
                  </div>
                </div>

                <input type="submit" class="btn bg-adduOrange" value="   Save   " />
              </form>
            </div>

            <script>
              window.addEventListener("DOMContentLoaded", function () {
                (function ($) {
                  $('#status').val("<%= selectedUser.status %>").change();
                })(jQuery);
              });
            </script>
            <% } %>
          </div>
  </div>

  <div class="container">
    <div class="row">
      <div class="col-sm-4">
        <h3>Positive</h3>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
        <p>
          Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...
        </p>
      </div>
      <div class="col-sm-4">
        <h3>Negative</h3>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
        <p>
          Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...
        </p>
      </div>
      <div class="col-sm-4">
        <h3>False Positive</h3>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
        <p>
          Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...
        </p>
      </div>
    </div>
  </div>

  <script defer type="text/javascript" charset="utf8"
    src="https://cdn.datatables.net/1.11.1/js/jquery.dataTables.js"></script>

  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"
    integrity="sha512-T/tUfKSV1bihCnd+MxKD0Hm1uBBroVYBOYSk1knyvQ9VyZJpc/ALb4P0r6ubwVPSGB2GvjeoMAJJImBG12TiaQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    window.addEventListener("DOMContentLoaded", function () {
      (function ($) {
        const table = $("#myTable").DataTable();

        $("#myTable tbody").on("click", "tr", function () {
          const data = table.row(this).data();
          window.location = `/dashboard?id=${data[0]}`;
        });

        $('#filterButton').on('click', function () {
          const statusFilter = $('#statusFilter').val();
          const fromDateFilter = $('#fromDateFilter').val();
          const toDateFilter = $('#toDateFilter').val();
          window.location = `/dashboard?statusFilter=${statusFilter}&fromDateFilter=${fromDateFilter}&toDateFilter=${toDateFilter}`;
        });

        const urlParams = new URLSearchParams(window.location.search);
        $('#statusFilter').val(urlParams.get('statusFilter'));
        $('#fromDateFilter').val(urlParams.get('fromDateFilter'));
        $('#toDateFilter').val(urlParams.get('toDateFilter'));

        $('.input-daterange').datepicker({
          orientation: "bottom auto",
          format: 'yyyy-mm-dd'
        });
      })(jQuery);
    });
  </script>

  <%- include('./partials/_bottom') %>